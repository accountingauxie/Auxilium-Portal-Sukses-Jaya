<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<title>Purchase Order - Xero Final</title>

<link rel="stylesheet" href="https://unpkg.com/choices.js/public/assets/styles/choices.min.css">
<script src="https://unpkg.com/choices.js/public/assets/scripts/choices.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

<style>
:root {
  --xero-blue:#116999;
  --border-light:#e0e0e0;
  --locked-bg:#f9f9f9;
  --green-bg:#dcfce7; --green-text:#166534;
  --red-bg:#fee2e2; --red-text:#991b1b;
}

*{box-sizing:border-box}
body{margin:0;background:#f4f5f6;font-family:Arial,sans-serif;font-size:13px}

/* ===== FINAL FIX (ANTI DOUBLE SCROLL) ===== */
.invoice-card,
.table-container,
.choices{
  overflow:visible !important;
}

.choices__list--dropdown{
  position:fixed !important;
  max-height:250px !important;
  overflow-y:auto !important;
  overflow-x:hidden !important;
  z-index:999999 !important;
  border:1px solid var(--xero-blue) !important;
  box-shadow:0 6px 20px rgba(0,0,0,.2);
}

.choices__list--dropdown::-webkit-scrollbar{display:none}
/* ======================================== */

.page-wrap{padding:30px;display:flex;justify-content:center}
.invoice-card{
  background:#fff;
  width:100%;
  max-width:1600px;
  padding:30px;
  border:1px solid #ddd;
}

.header-grid{
  display:grid;
  grid-template-columns:2fr 1fr 1fr 1fr 1fr;
  gap:15px;
  margin-bottom:20px;
}

.field-label{font-size:12px;font-weight:700;margin-bottom:6px;display:block}

.main-input{
  width:100%;
  height:38px;
  border:1px solid #ccc;
  padding:0 10px;
  border-radius:3px;
}

.table-container{
  border:1px solid #ccc;
}

table{
  width:100%;
  border-collapse:separate;
  border-spacing:0;
  min-width:1400px;
}

th,td{
  border-bottom:1px solid var(--border-light);
  border-right:1px solid var(--border-light);
}

th{
  background:#f8f9fa;
  padding:10px;
  font-size:12px;
}

td{height:42px}

input{
  width:100%;
  height:100%;
  border:none;
  padding:0 10px;
}

.col-drag,.col-del{
  position:sticky;
  background:var(--locked-bg);
  z-index:10;
}

.col-drag{left:0;width:40px}
.col-del{right:0;width:45px}

.drag-cell{cursor:grab;text-align:center}

.status-badge{
  font-size:10px;
  font-weight:700;
  padding:3px 6px;
  border-radius:4px;
}

.status-ok{background:var(--green-bg);color:var(--green-text)}
.status-oos{background:var(--red-bg);color:var(--red-text)}

.add-row-btn{
  margin-top:15px;
  border:1px solid var(--xero-blue);
  background:#fff;
  color:var(--xero-blue);
  padding:8px 16px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="page-wrap">
<div class="invoice-card">

<div class="header-grid">
  <div><span class="field-label">Customer</span><select id="customerSelect"></select></div>
  <div><span class="field-label">Order Type</span><select id="orderType">
    <option>General Order</option><option>Pre-Order</option>
  </select></div>
  <div><span class="field-label">Date</span><input type="date" id="issueDate" class="main-input"></div>
  <div><span class="field-label">Est Delivery</span><input type="date" class="main-input"></div>
  <div><span class="field-label">Order #</span><input class="main-input" value="1000001" readonly></div>
</div>

<div class="table-container">
<table>
<thead>
<tr>
<th class="col-drag"></th>
<th>Type</th>
<th>Item</th>
<th>Unit</th>
<th>Meter</th>
<th>Qty</th>
<th>Price</th>
<th>Disc</th>
<th>Amount</th>
<th>Total</th>
<th>Stock</th>
<th>Status</th>
<th class="col-del"></th>
</tr>
</thead>
<tbody id="itemsBody"></tbody>
</table>
</div>

<button class="add-row-btn" onclick="addRow()">+ Add Row</button>

</div>
</div>

<script>
let listSpandek=["SP-01","SP-02"];
let listNonSpandek=["NS-01","NS-02"];

function addRow(){
  const tr=document.createElement("tr");
  tr.innerHTML=`
    <td class="drag-cell">::</td>
    <td><select class="type"></select></td>
    <td><select class="item"></select></td>
    <td><input readonly></td>
    <td><input></td>
    <td><input></td>
    <td><input readonly></td>
    <td><input value="0"></td>
    <td><input readonly></td>
    <td><input readonly></td>
    <td>-</td>
    <td></td>
    <td class="col-del">ðŸ—‘</td>
  `;
  itemsBody.appendChild(tr);

  const typeSel=tr.querySelector(".type");
  const itemSel=tr.querySelector(".item");

  const typeChoice=new Choices(typeSel,{
    choices:[{value:"Spandek"},{value:"Non Spandek"}],
    searchEnabled:false,
    shouldSort:false
  });

  const itemChoice=new Choices(itemSel,{
    searchEnabled:true,
    shouldSort:false
  });

  const fixDropdown=(e)=>{
    const c=e.target.closest(".choices");
    const d=c.querySelector(".choices__list--dropdown");
    const r=c.getBoundingClientRect();
    d.style.top=r.bottom+"px";
    d.style.left=r.left+"px";
    d.style.width=r.width+"px";
  };

  typeSel.addEventListener("showDropdown",fixDropdown);
  itemSel.addEventListener("showDropdown",fixDropdown);

  typeSel.addEventListener("change",()=>{
    itemChoice.clearChoices();
    const list=typeSel.value==="Spandek"?listSpandek:listNonSpandek;
    itemChoice.setChoices(list.map(v=>({value:v,label:v})), "value","label",true);
  });
}

addRow();
</script>

</body>
</html>
