<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<title>Persiapan Produksi - Auxilium</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
/* --- 1. SYSTEM STYLE (Sama persis dengan Review Penjualan) --- */
:root { 
    --primary-color: #116999; 
    --bg-color: #f4f7f6; 
    --text-color: #333; 
    --red-bg: #fee2e2; 
    --red-text: #991b1b;
}

* { box-sizing: border-box; }
body { margin: 0; font-family: "Arial", sans-serif; font-size: 13px; background: var(--bg-color); color: var(--text-color); }

/* --- NAVIGATION BAR --- */
.aux-navbar {
    background-color: #ffffff;
    height: 70px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 40px;
    box-shadow: 0 1px 5px rgba(0,0,0,0.05);
    position: sticky; top: 0; z-index: 10000;
}
.aux-logo img { height: 40px; width: auto; display: block; }
.aux-menu { display: flex; gap: 10px; align-items: center; height: 100%; }
.nav-item { position: relative; height: 100%; display: flex; align-items: center; }
.aux-link { text-decoration: none; color: #666; font-weight: 600; font-size: 14px; padding: 8px 14px; border-radius: 6px; transition: all 0.2s; cursor: pointer; display: flex; align-items: center; gap: 4px; }
.aux-link:hover, .nav-item:hover .aux-link { color: #1d2939; background-color: #f9fafb; }
.aux-link.active { color: var(--primary-color); background-color: #eff8ff; font-weight: 700; }

/* Dropdown */
.dropdown-menu { visibility: hidden; opacity: 0; position: absolute; top: 90%; left: 50%; transform: translateX(-50%) translateY(-10px); background: white; min-width: 220px; border: 1px solid #eaecf0; border-radius: 8px; box-shadow: 0 12px 16px -4px rgba(16, 24, 40, 0.08); padding: 6px; z-index: 100000; transition: all 0.2s ease; }
.dropdown-menu::before { content: ""; position: absolute; top: -20px; left: 0; width: 100%; height: 20px; background: transparent; }
.nav-item:hover .dropdown-menu { visibility: visible; opacity: 1; transform: translateX(-50%) translateY(0); }
.dropdown-item { display: block; padding: 10px 12px; color: #344054; text-decoration: none; font-size: 14px; border-radius: 6px; transition: background 0.2s; text-align: left; font-weight: 400; }
.dropdown-item:hover { background-color: #f9fafb; color: #2f54eb; }

/* User Panel */
.user-panel { display: flex; align-items: center; gap: 12px; padding-left: 20px; border-left: 1px solid #eee; }
.user-details { display: flex; flex-direction: column; text-align: right; line-height: 1.3; }
.user-name { font-weight: 700; font-size: 13px; color: #333; }
.user-role { font-size: 11px; color: #888; }
.user-avatar { width: 36px; height: 36px; background-color: var(--primary-color); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; user-select: none; }
.logout-btn { background: none; border: 1px solid #ddd; color: #666; width: 32px; height: 32px; border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; font-size: 14px; }
.logout-btn:hover { background-color: var(--red-bg); color: var(--red-text); border-color: var(--red-bg); }

/* --- CONTENT STYLE --- */
.page-wrap { padding: 30px 40px; max-width: 98%; margin: 0 auto; }
.category-tabs { margin-bottom: 20px; border-bottom: 2px solid #ddd; }
.cat-btn { background: none; border: none; padding: 10px 20px; font-weight: 600; color: #666; cursor: pointer; border-bottom: 3px solid transparent; }
.cat-btn.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }

.table-card { background: #fff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); overflow: hidden; min-height: 400px; }
table.xero-table { width: 100%; border-collapse: collapse; }
table.xero-table th { text-align: left; padding: 15px; background: #f8f9fa; border-bottom: 1px solid #eee; color: #555; font-size: 12px; text-transform: uppercase; font-weight: bold; }
table.xero-table td { padding: 15px; border-bottom: 1px solid #eee; vertical-align: middle; }
table.xero-table tr.data-row { cursor: pointer; transition: background-color 0.2s; }
table.xero-table tr.data-row:hover { background-color: #e0f2fe; }

/* --- STYLE KHUSUS PRODUKSI --- */
.prod-input { width: 100%; padding: 6px; border: 1px solid #ccc; border-radius: 4px; font-size: 12px; }
.prod-select { width: 100%; padding: 6px; border: 1px solid #ccc; border-radius: 4px; font-size: 12px; background: #fff; }
.prod-input[readonly] { background-color: #eee; color: #666; }

/* Split Row Styling */
.split-row { background-color: #fffde7; } /* Kuning tipis */
.main-row { background-color: #fff; }

.btn-sm { padding: 4px 8px; font-size: 11px; border-radius: 3px; cursor: pointer; border: 1px solid transparent; }
.btn-split { background: #f3e8ff; color: #6b21a8; border-color: #d8b4fe; }
.btn-remove { background: #fef2f2; color: #991b1b; border-color: #fee2e2; }

/* --- MODAL STYLE --- */
.modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 9000; backdrop-filter: blur(2px); }
.modal-box { background: #fff; width: 1300px; max-width: 98%; height: 95vh; display: flex; flex-direction: column; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
.modal-header { padding: 20px 30px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; background: #fff; }
.modal-body { flex: 1; overflow-y: auto; padding: 20px; background: #fff; }
.modal-footer { padding: 15px 30px; background: #f9fafb; border-top: 1px solid #eee; text-align: right; }

.btn-action { padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; color: white; font-weight: bold; margin-left: 10px; transition: 0.2s; }
.btn-close { background: #fff; color: #333; border: 1px solid #ccc; }
.btn-process { background: #116999; }

/* --- PDF STYLE (SURAT JALAN) --- */
#pdf-hidden-container { position: absolute; left: -9999px; top: 0; }
#pdfContent { background: #fff; width: 100%; padding: 0; font-family: "Arial", sans-serif; color: #000; }
.pdf-header { display: flex; justify-content: space-between; margin-bottom: 20px; border-bottom: 2px solid #000; padding-bottom: 10px; }
.pdf-title { font-size: 24px; font-weight: 800; text-transform: uppercase; color: #000; }
.pdf-subtitle { font-size: 14px; font-weight: bold; color: #444; margin-top: 5px; text-transform: uppercase; }

table.pdf-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
table.pdf-table th { font-size: 10px; font-weight: 700; text-transform: uppercase; padding: 8px 4px; border: 1px solid #000; background: #eee; }
table.pdf-table td { padding: 8px 4px; font-size: 11px; vertical-align: top; border: 1px solid #000; }
.we-code { font-family: "Courier New", monospace; font-weight: bold; letter-spacing: 1px; }
</style>
</head>
<body>

<div class="aux-navbar">
    <div class="aux-logo">
        <img src="https://raw.githubusercontent.com/accountingauxie/Auxilium-Portal-Sukses-Jaya/refs/heads/main/assets/auxilium_logo_pure_white_bg.png" alt="Auxilium Logo">
    </div>
    
    <nav class="aux-menu">
        <div class="nav-item"><a href="https://accountingauxie.github.io/Auxilium-Portal-Sukses-Jaya/" class="aux-link">Home</a></div>
        <div class="nav-item">
            <div class="aux-link">Penjualan <i class="fas fa-chevron-down" style="font-size:10px; margin-left:4px;"></i></div>
            <div class="dropdown-menu">
                <a href="https://accountingauxie.github.io/Auxilium-Portal-Sukses-Jaya/Penjualan/Review%20Penjualan/" class="dropdown-item">Review Penjualan</a>
            </div>
        </div>
        <div class="nav-item">
            <div class="aux-link active">Produksi <i class="fas fa-chevron-down" style="font-size:10px; margin-left:4px;"></i></div>
            <div class="dropdown-menu">
                <a href="#" class="dropdown-item">Persiapan Pesanan</a>
                <a href="#" onclick="alert('Coming soon')" class="dropdown-item">Produksi Barang Jadi</a>
            </div>
        </div>
    </nav>

    <div class="user-panel">
        <div class="user-details"><span class="user-name">Admin Produksi</span><span class="user-role">CV Sukses Jaya</span></div>
        <div class="user-avatar">AP</div>
    </div>
</div>

<div class="page-wrap">
    <h2>Persiapan Produksi (General Order)</h2>
    
    <div class="category-tabs">
        <button class="cat-btn active" id="tab-awaiting" onclick="loadOrders()">Awaiting Production</button>
        <button class="cat-btn" id="tab-process" onclick="alert('Fitur Process View akan segera hadir')">In Process</button>
        <button class="cat-btn" id="tab-completed" onclick="alert('History selesai akan segera hadir')">Completed</button>
    </div>

    <div class="table-card">
        <table class="xero-table">
            <thead>
                <tr>
                    <th>Order #</th>
                    <th>Customer</th>
                    <th>Order Date</th>
                    <th>Est. Delivery</th>
                    <th>Items Count</th>
                    <th style="text-align:center;">Action</th>
                </tr>
            </thead>
            <tbody id="dashboardBody">
                <tr><td colspan="6" style="text-align:center; padding:50px; color:#999;">Loading Data...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<div id="setupModal" class="modal-overlay">
    <div class="modal-box">
        <div class="modal-header">
            <div>
                <h3 style="margin:0; font-size: 18px;">Setup Produksi: <span id="modalOrderNo" style="font-weight:bold; color:var(--primary-color);"></span></h3>
                <span style="font-size:12px; color:#666;" id="modalCustomer"></span>
            </div>
            <button class="btn-close" onclick="closeModal()" style="border:none; background:none; font-size:24px; cursor:pointer;">&times;</button>
        </div>
        
        <div class="modal-body">
            <div class="alert" style="background:#e0f2fe; color:#0c4a6e; padding:10px; border-radius:6px; margin-bottom:15px; font-size:12px;">
                <i class="fas fa-info-circle"></i> <strong>Instruksi:</strong> Lengkapi Mesin dan KPC untuk item Spandek. Gunakan tombol "Split" jika stok KPC tidak cukup.
            </div>

            <table class="xero-table" id="productionTable">
                <thead>
                    <tr>
                        <th style="width:20%">Nama Barang</th>
                        <th style="width:8%; text-align:center;">Meter</th>
                        <th style="width:8%; text-align:center;">Total Qty</th>
                        <th style="width:10%; text-align:center;">Assigned Qty</th>
                        <th style="width:12%">Mesin</th>
                        <th style="width:15%">KPC Code (Stok)</th>
                        <th style="width:10%">Type</th>
                        <th style="width:12%">Work Effort Code</th>
                        <th style="width:5%">Action</th>
                    </tr>
                </thead>
                <tbody id="setupBody"></tbody>
            </table>
            <div id="validationMsg" style="color:red; font-weight:bold; margin-top:10px; display:none;"></div>
        </div>

        <div class="modal-footer">
            <button class="btn-action btn-close" onclick="closeModal()">Cancel</button>
            <button class="btn-action btn-process" onclick="submitProduction()">Process & Print PDF</button>
        </div>
    </div>
</div>

<div id="pdf-hidden-container">
    <div id="pdfContent">
        <div class="pdf-header">
            <div>
                <div class="pdf-title">SURAT PERINTAH KERJA</div>
                <div class="pdf-subtitle">Produksi (Internal Use Only)</div>
            </div>
            <div style="text-align:right;">
                <div style="font-size:16px; font-weight:bold;" id="pdfOrderNo">-</div>
                <div style="font-size:11px;">Date: <span id="pdfDate">-</span></div>
            </div>
        </div>

        <div style="margin-bottom:20px; border:1px solid #000; padding:10px;">
            <strong>Customer:</strong> <span id="pdfCustomer">-</span><br>
            <strong>Delivery Est:</strong> <span id="pdfEst">-</span>
        </div>

        <table class="pdf-table">
            <thead>
                <tr>
                    <th>Nama Barang</th>
                    <th style="text-align:center;">Meter</th>
                    <th style="text-align:center;">Qty</th>
                    <th>Mesin / KPC / Type</th>
                    <th>Work Effort Code</th>
                </tr>
            </thead>
            <tbody id="pdfItemsBody"></tbody>
        </table>

        <div style="margin-top:40px; display:flex; justify-content:space-between; text-align:center;">
            <div style="width:30%;">
                <div>Dibuat Oleh,</div>
                <br><br><br>
                <div style="border-top:1px solid #000; width:80%; margin:0 auto;">( Admin Produksi )</div>
            </div>
            <div style="width:30%;">
                <div>Diterima Oleh,</div>
                <br><br><br>
                <div style="border-top:1px solid #000; width:80%; margin:0 auto;">( Operator Mesin )</div>
            </div>
            <div style="width:30%;">
                <div>Diketahui Oleh,</div>
                <br><br><br>
                <div style="border-top:1px solid #000; width:80%; margin:0 auto;">( Kepala Produksi )</div>
            </div>
        </div>
    </div>
</div>

<script>
// =========================================================
// KONFIGURASI BASE URL
// Silakan Ganti URL ini dengan URL Web App Deployment Anda
// =========================================================
const BASE_URL = "https://script.google.com/macros/s/AKfycbxmfwf0e9_K1TwaCGqmvCMSAX11UsCgctqX9newCThLpssio-GE3KECfVYdItZRCBJV5Q/exec"; 

let currentOrders = {}; 
let activeOrderId = null;

window.onload = loadOrders;

// --- 1. LOAD DATA (FETCH API) ---
async function loadOrders() {
    const tbody = document.getElementById('dashboardBody');
    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; padding:30px;">Loading Data...</td></tr>';
    
    try {
        // Panggil Action "getProductionOrders" di Backend
        // Pastikan Anda sudah update Main.gs untuk handle "getProductionOrders" via doGet
        // atau update Main.gs untuk return JSON jika action=getProductionOrders
        
        // Asumsi: Kita pakai endpoint yang sama, tapi param action beda
        const response = await fetch(BASE_URL + "?action=getProductionOrders");
        const data = await response.json();
        
        renderDashboard(data);
    } catch (err) {
        console.error(err);
        tbody.innerHTML = `<tr><td colspan="6" style="color:red; text-align:center;">Error Loading Data. Pastikan Script sudah di-deploy dengan akses 'Anyone'.<br>${err}</td></tr>`;
    }
}

function renderDashboard(data) {
    const tbody = document.getElementById('dashboardBody');
    tbody.innerHTML = '';
    
    // Jika data kosong atau error object kosong
    if (!data || Object.keys(data).length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; padding:30px; color:#999;">Tidak ada pesanan "Awaiting Production".</td></tr>';
        return;
    }

    currentOrders = data; 

    Object.keys(data).forEach(key => {
        const o = data[key];
        const tr = document.createElement('tr');
        tr.className = 'data-row';
        tr.innerHTML = `
            <td><strong>${o.orderNo}</strong></td>
            <td>${o.customer}</td>
            <td>${o.date}</td>
            <td>${o.delivery || '-'}</td>
            <td>${o.items.length} Items</td>
            <td style="text-align:center;">
                <button class="btn-action btn-process" style="padding:5px 10px; font-size:11px;" onclick="openSetup('${o.orderNo}')">Setup</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

// --- 2. MODAL & SETUP LOGIC ---
function openSetup(orderId) {
    activeOrderId = orderId;
    const order = currentOrders[orderId];
    
    document.getElementById('modalOrderNo').innerText = orderId;
    document.getElementById('modalCustomer').innerText = order.customer;
    
    const tbody = document.getElementById('setupBody');
    tbody.innerHTML = '';

    order.items.forEach((item, idx) => {
        const isSpandek = (item.type && item.type.toLowerCase().includes('spandek') && !item.type.toLowerCase().includes('non'));
        
        const tr = document.createElement('tr');
        tr.className = 'main-row';
        tr.dataset.id = idx; 
        tr.dataset.type = isSpandek ? 'spandek' : 'non-spandek';
        tr.dataset.original = item.fullRowData; 
        tr.dataset.rowindex = item.rowIndex;

        let html = `
            <td>
                <strong>${item.item}</strong>
                <div style="font-size:10px; color:#666;">Original Type: ${item.type}</div>
            </td>
            <td style="text-align:center;">${item.meter || '-'}</td>
            <td style="text-align:center;">
                <span class="target-qty badge badge-approve" style="font-size:12px;">${item.qty}</span>
            </td>
        `;

        if (isSpandek) {
            html += `
                <td><input type="number" class="prod-input qty-input" value="${item.qty}" min="1" onchange="validateQty(${idx})"></td>
                <td>
                    <select class="prod-select machine-select" onchange="generateWE(this)">
                        <option value="">- Pilih -</option>
                        <option value="PM08">MX PUMA 08</option>
                        <option value="PM14">MX PUMA 14</option>
                    </select>
                </td>
                <td>
                    <select class="prod-select kpc-select" onchange="generateWE(this)">
                        <option value="">- Pilih KPC -</option>
                        <option value="KPC-001">KPC-001 (Stock: 500m)</option>
                        <option value="KPC-002">KPC-002 (Stock: 120m)</option>
                    </select>
                </td>
                <td>
                    <select class="prod-select type-select" onchange="generateWE(this)">
                        <option value="Custom">Custom</option>
                        <option value="Plat">Plat</option>
                    </select>
                </td>
                <td>
                    <input type="text" class="prod-input we-code-input" readonly placeholder="Auto...">
                </td>
                <td style="text-align:center;">
                    <button class="btn-sm btn-split" onclick="splitRow(this, ${idx})"><i class="fas fa-code-branch"></i> Split</button>
                </td>
            `;
        } else {
            html += `
                <td style="text-align:center;"><input type="hidden" class="qty-input" value="${item.qty}">${item.qty}</td>
                <td colspan="4" style="text-align:center; color:#999; font-style:italic; background:#f9f9f9;">
                    Non-Spandek (Tidak perlu setup)
                </td>
                <td style="text-align:center;">-</td>
            `;
        }
        
        tr.innerHTML = html;
        tbody.appendChild(tr);
    });

    document.getElementById('validationMsg').style.display = 'none';
    document.getElementById('setupModal').style.display = 'flex';
}

function closeModal() {
    document.getElementById('setupModal').style.display = 'none';
}

// --- 3. SPLIT & WE LOGIC ---
function generateWE(el) {
    const row = el.closest('tr');
    const machine = row.querySelector('.machine-select').value;
    const kpc = row.querySelector('.kpc-select').value;
    const output = row.querySelector('.we-code-input');
    
    if(machine && kpc) {
        output.value = `${machine}_${kpc}_${activeOrderId}`;
    } else {
        output.value = '';
    }
}

function splitRow(btn, groupId) {
    const originalRow = btn.closest('tr');
    const newRow = originalRow.cloneNode(true);
    
    newRow.classList.remove('main-row');
    newRow.classList.add('split-row');
    
    // Reset Inputs
    newRow.querySelector('.qty-input').value = 0;
    newRow.querySelectorAll('select').forEach(s => {
        s.value = "";
        s.onchange = function() { generateWE(this); };
    });
    newRow.querySelector('.we-code-input').value = "";
    newRow.querySelector('.target-qty').parentElement.innerHTML = ""; 

    // Ubah tombol
    const actionTd = newRow.lastElementChild;
    actionTd.innerHTML = `<button class="btn-sm btn-remove" onclick="removeSplit(this, ${groupId})"><i class="fas fa-trash"></i></button>`;
    
    newRow.querySelector('.qty-input').onchange = function() { validateQty(groupId); };
    originalRow.after(newRow);
}

function removeSplit(btn, groupId) {
    btn.closest('tr').remove();
    validateQty(groupId);
}

function validateQty(groupId) {
    const tbody = document.getElementById('setupBody');
    const rows = tbody.querySelectorAll(`tr[data-id="${groupId}"]`);
    
    let target = 0;
    let totalAssigned = 0;

    rows.forEach(r => {
        if(r.classList.contains('main-row')) {
            target = parseInt(r.querySelector('.target-qty').innerText);
        }
        totalAssigned += parseInt(r.querySelector('.qty-input').value || 0);
    });

    const msg = document.getElementById('validationMsg');
    
    rows.forEach(r => {
        const input = r.querySelector('.qty-input');
        if(totalAssigned !== target) {
            input.style.borderColor = 'red';
        } else {
            input.style.borderColor = '#ccc';
        }
    });

    if(totalAssigned !== target) {
        msg.style.display = 'block';
        msg.innerText = `Total Qty Item Group ini (${totalAssigned}) tidak sama dengan Target (${target}).`;
        return false;
    } else {
        msg.style.display = 'none';
        return true;
    }
}

// --- 4. SUBMIT & PRINT ---
async function submitProduction() {
    const tbody = document.getElementById('setupBody');
    const rows = tbody.querySelectorAll('tr');
    let isValid = true;
    let submitData = [];
    let pdfData = [];

    if(document.getElementById('validationMsg').style.display === 'block') {
        alert("Harap perbaiki jumlah Qty (Split) yang tidak sesuai target.");
        return;
    }

    rows.forEach(row => {
        const isSpandek = row.dataset.type === 'spandek';
        const qty = row.querySelector('.qty-input').value;
        
        let itemData = {
            originalData: row.dataset.original,
            originalRowIndex: row.classList.contains('main-row') ? row.dataset.rowindex : null,
            isSplit: row.classList.contains('split-row'),
            qty: qty,
            machine: '', kpc: '', we: ''
        };

        let pdfItem = {
            name: row.cells[0].querySelector('strong').innerText,
            meter: row.cells[1].innerText,
            qty: qty,
            detail: '-',
            we: '-'
        };

        if(isSpandek) {
            const machine = row.querySelector('.machine-select').value;
            const kpc = row.querySelector('.kpc-select').value;
            const we = row.querySelector('.we-code-input').value;
            const type = row.querySelector('.type-select').value;

            if(!machine || !kpc || !we || qty <= 0) {
                row.style.backgroundColor = '#fee2e2'; 
                isValid = false;
            } else {
                row.style.backgroundColor = row.classList.contains('split-row') ? '#fffde7' : '#fff';
                itemData.machine = machine;
                itemData.kpc = kpc;
                itemData.we = we;

                pdfItem.detail = `${machine} / ${kpc} / ${type}`;
                pdfItem.we = we;
            }
        }
        submitData.push(itemData);
        pdfData.push(pdfItem);
    });

    if(!isValid) {
        alert("Mohon lengkapi Mesin dan KPC untuk semua item Spandek.");
        return;
    }

    // Generate PDF dulu
    generatePDF(activeOrderId, pdfData);

    // Kirim Data ke Backend
    const btn = document.querySelector('.btn-process');
    const oldText = btn.innerText;
    btn.innerText = "Processing...";
    btn.disabled = true;

    try {
        const payload = {
            action: 'submitProduction',
            orderId: activeOrderId,
            data: submitData
        };

        // Gunakan POST untuk kirim data
        const res = await fetch(BASE_URL, {
            method: 'POST',
            body: JSON.stringify(payload)
        });
        
        const result = await res.json();
        
        if(result.result === 'error') throw new Error(result.message);

        alert("Sukses! " + (result.message || "Data berhasil diproses."));
        closeModal();
        loadOrders(); 

    } catch (e) {
        alert("Error submit: " + e.message);
    } finally {
        btn.innerText = oldText;
        btn.disabled = false;
    }
}

function generatePDF(orderId, items) {
    const o = currentOrders[orderId];
    
    document.getElementById('pdfOrderNo').innerText = orderId;
    document.getElementById('pdfDate').innerText = new Date().toLocaleDateString('id-ID');
    document.getElementById('pdfCustomer').innerText = o.customer;
    document.getElementById('pdfEst').innerText = o.delivery;

    const tbody = document.getElementById('pdfItemsBody');
    tbody.innerHTML = '';
    
    items.forEach(item => {
        tbody.innerHTML += `<tr><td>${item.name}</td><td style="text-align:center;">${item.meter}</td><td style="text-align:center;">${item.qty}</td><td>${item.detail}</td><td class="we-code">${item.we}</td></tr>`;
    });

    const el = document.getElementById('pdfContent');
    const opt = { 
        margin: [0.5, 0.5, 0.5, 0.5], 
        filename: `SPK_${orderId}.pdf`, 
        image: { type: 'jpeg', quality: 0.98 }, 
        html2canvas: { scale: 2 }, 
        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' } 
    };
    html2pdf().set(opt).from(el).save();
}
</script>

</body>
</html>
