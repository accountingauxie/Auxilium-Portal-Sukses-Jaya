<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AUXILIUM Portal – CV. Sukses Jaya</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: Inter, sans-serif; }
    body { background: #f5f6fa; min-height: 100vh; }
    .hidden { display: none; }
    .card, .container, .topbar { background: white; border-radius: 14px; padding: 24px; margin: 20px auto; box-shadow: 0 6px 22px rgba(0,0,0,0.12); }
    .card { width: 360px; }
    input, button { width: 100%; padding: 10px; margin-bottom: 14px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; }
    button { background: #2563eb; color: white; border: none; border-radius: 999px; cursor: pointer; }
    .btn-logout { background: #ef4444; margin-bottom: 0; }
    .msg { font-size: 13px; margin-bottom: 10px; padding: 8px; border-radius: 8px; display: none; }
    .error { background: #fee2e2; color: #b91c1c; }
    .success { background: #dcfce7; color: #166534; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 10px; border-bottom: 1px solid #e5e7eb; font-size: 13px; }
    .badge { padding: 4px 10px; border-radius: 999px; font-size: 12px; font-weight: 600; }
    .approved { background: #dcfce7; color: #166534; }
    .pending { background: #fef3c7; color: #92400e; }
    .admin { background: #dbeafe; color: #1d4ed8; }
    .btn { font-size: 12px; margin-right: 4px; border-radius: 999px; padding: 6px 12px; border: none; cursor: pointer; }
    .btn-on { background: #22c55e; color: white; }
    .btn-off { background: #e5e7eb; color: #374151; }
    .btn-approve { background: #22c55e; color: white; }
    .btn-pending { background: #fca5a5; color: #991b1b; }
  </style>
</head>
<body>
  <!-- LOGIN -->
  <section id="login-section">
    <div class="card">
      <h2>Login</h2>
      <div id="login-msg" class="msg"></div>
      <input id="login-email" placeholder="Email" type="email">
      <input id="login-password" placeholder="Password" type="password">
      <button onclick="login()">Login</button>
      <p>Belum punya akun? <a href="#" onclick="showSection('register')">Daftar</a></p>
    </div>
  </section>

  <!-- REGISTER -->
  <section id="register-section" class="hidden">
    <div class="card">
      <h2>Register</h2>
      <div id="register-msg" class="msg"></div>
      <input id="reg-email" placeholder="Email" type="email">
      <input id="reg-password" placeholder="Password" type="password">
      <input id="reg-password2" placeholder="Ulangi Password" type="password">
      <button onclick="registerUser()">Daftar</button>
      <p>Sudah punya akun? <a href="#" onclick="showSection('login')">Login</a></p>
    </div>
  </section>

  <!-- ADMIN -->
  <section id="admin-section" class="hidden">
    <div class="topbar">
      <h2>Admin Panel</h2>
      <button class="btn btn-logout" onclick="logout()">Logout</button>
    </div>
    <div class="container">
      <h3>Daftar User</h3>
      <table>
        <thead>
          <tr><th>Email</th><th>Status</th><th>Role</th><th>Receiving</th><th>FG</th><th>Order</th><th>Aksi</th></tr>
        </thead>
        <tbody id="user-list"></tbody>
      </table>
    </div>
  </section>

  <script>
    function showSection(id) {
      document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
      document.getElementById(id + '-section').classList.remove('hidden');
    }

    function ensureAccess(user) {
      if (!user.access) {
        user.access = { receiving: user.role === 'admin', finished_goods: user.role === 'admin', order_form: user.role === 'admin' };
      }
      return user;
    }

    function getUsers() {
      const raw = localStorage.getItem("uxilium_users");
      const arr = raw ? JSON.parse(raw) : [];
      return arr.map(ensureAccess);
    }

    function saveUsers(arr) {
      localStorage.setItem("uxilium_users", JSON.stringify(arr));
    }

    function registerUser() {
      const u = reg-email.value.trim(), p = reg-password.value.trim(), p2 = reg-password2.value.trim();
      const msg = document.getElementById("register-msg");
      if (!u || !p) return showMsg(msg, "Semua field wajib diisi.", "error");
      if (p !== p2) return showMsg(msg, "Password tidak cocok.", "error");
      const users = getUsers();
      if (users.some(x => x.email === u)) return showMsg(msg, "Email sudah digunakan.", "error");
      users.push(ensureAccess({ email: u, password: p, approved: false, role: "user" }));
      saveUsers(users);
      showMsg(msg, "Registrasi berhasil! Menunggu persetujuan admin.", "success");
      setTimeout(() => showSection('login'), 1000);
    }

    function login() {
      const u = login-email.value.trim(), p = login-password.value.trim();
      const msg = document.getElementById("login-msg");
      const users = getUsers();
      const user = users.find(x => x.email === u && x.password === p);
      if (!user) return showMsg(msg, "Email atau password salah.", "error");
      if (!user.approved && user.role !== "admin") return showMsg(msg, "Akun belum disetujui.", "error");
      localStorage.setItem("uxilium_current_user", JSON.stringify(user));
      showMsg(msg, "Login berhasil!", "success");
      setTimeout(() => user.role === "admin" ? showSection('admin') & renderUsers() : alert("Redirect ke halaman user"), 700);
    }

    function logout() {
      localStorage.removeItem("uxilium_current_user");
      showSection('login');
    }

    function showMsg(el, text, type) {
      el.textContent = text;
      el.className = "msg " + type;
      el.style.display = "block";
    }

    function renderUsers() {
      const users = getUsers();
      const list = document.getElementById("user-list");
      list.innerHTML = "";
      users.forEach((u, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${u.email}</td>
          <td><span class="badge ${u.approved ? 'approved' : 'pending'}">${u.approved ? 'Approved' : 'Pending'}</span></td>
          <td><span class="badge ${u.role === 'admin' ? 'admin' : ''}">${u.role}</span></td>
          <td></td><td></td><td></td><td></td>`;
        const cells = tr.querySelectorAll("td");
        ["receiving", "finished_goods", "order_form"].forEach((key, j) => {
          const btn = document.createElement("button");
          const on = !!u.access[key];
          btn.className = "btn " + (on ? "btn-on" : "btn-off");
          btn.textContent = (on ? "On " : "Off ") + key.replace("_", " ");
          btn.onclick = () => { users[i].access[key] = !on; saveUsers(users); renderUsers(); };
          cells[3 + j].appendChild(btn);
        });
        const actionCell = cells[6];
        if (u.role !== "admin") {
          const b = document.createElement("button");
          b.className = "btn " + (u.approved ? "btn-pending" : "btn-approve");
          b.textContent = u.approved ? "Set Pending" : "Approve";
          b.onclick = () => { users[i].approved = !u.approved; saveUsers(users); renderUsers(); };
          actionCell.appendChild(b);
        } else actionCell.textContent = "—";
        list.appendChild(tr);
      });
    }

    // Default section: login
    showSection('login');
  </script>
</body>
</html>
